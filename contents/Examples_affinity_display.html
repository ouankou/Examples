
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Affinity Display &#8212; OpenMP Application Programming Interface Examples</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.c441f2ba0852f4cabcb80105e3a46ae6.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Affinity Query Functions" href="Examples_affinity_query.html" />
    <link rel="prev" title="Task Affinity" href="Examples_task_affinity.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">OpenMP Application Programming Interface Examples</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome to OMP Jupyter Book
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="Foreword_Chapt.html">
   Foreword
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Introduction_Chapt.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Examples_Chapt.html">
   Examples
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_parallel_execution.html">
   Parallel Execution
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_ploop.html">
     A Simple Parallel Loop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_parallel.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       parallel
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_host_teams.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       teams
      </span>
     </code>
     Construct on Host
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nthrs_nesting.html">
     Controlling the Number of Threads on Multiple Nesting Levels
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nthrs_dynamic.html">
     Interaction Between the
     <code class="docutils literal notranslate">
      <span class="pre">
       num_threads
      </span>
     </code>
     Clause and
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_set_dynamic
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_do.html">
     Fortran Restrictions on the
     <code class="docutils literal notranslate">
      <span class="pre">
       do
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nowait.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       nowait
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_collapse.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       collapse
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_linear_in_loop.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       linear
      </span>
     </code>
     Clause in Loop Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_psections.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       parallel
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       sections
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fpriv_sections.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       firstprivate
      </span>
     </code>
     Clause and the
     <code class="docutils literal notranslate">
      <span class="pre">
       sections
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_single.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       single
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_workshare.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       workshare
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_master.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       master
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_loop.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       loop
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_pra_iterator.html">
     Parallel Random Access Iterator Loop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_set_dynamic_nthrs.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_set_dynamic
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_set_num_threads
      </span>
     </code>
     Routines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_get_nthrs.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_get_num_threads
      </span>
     </code>
     Routine
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="Chap_affinity.html">
   OpenMP Affinity
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_affinity.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       proc_bind
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_task_affinity.html">
     Task Affinity
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Affinity Display
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_affinity_query.html">
     Affinity Query Functions
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_tasking.html">
   Tasking
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_tasking.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       task
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       taskwait
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_task_priority.html">
     Task Priority
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_task_dep.html">
     Task Dependences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_taskgroup.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       taskgroup
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_taskyield.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       taskyield
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_taskloop.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       taskloop
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_parallel_master_taskloop.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       parallel
      </span>
      <span class="pre">
       master
      </span>
      <span class="pre">
       taskloop
      </span>
     </code>
     Construct
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_devices.html">
   Devices
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_defaultmap.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       defaultmap
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_pointer_mapping.html">
     Pointer mapping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_structure_mapping.html">
     Structure mapping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_array_sections.html">
     Array Sections in Device Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_array_shaping.html">
     Array Shaping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_mapper.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
      <span class="pre">
       mapper
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_data.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       data
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_unstructured_data.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       enter
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       data
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       exit
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       data
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_unstructured_data.html#simple-target-enter-data-and-target-exit-data-constructs">
     Simple target enter data and target exit data Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_update.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       update
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_declare_target.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_teams.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       teams
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_depend.html">
     Asynchronous
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Execution and Dependences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_with_tasks.html">
     Asynchronous
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     with Tasks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_nowait.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       nowait
      </span>
     </code>
     Clause on
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_nowait_depend.html">
     Asynchronous
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     with
     <code class="docutils literal notranslate">
      <span class="pre">
       nowait
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       depend
      </span>
     </code>
     Clauses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_device.html">
     Device Routines
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_SIMD.html">
   SIMD
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_SIMD.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       simd
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       simd
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_SIMD.html#inbranch-and-notinbranch-clauses">
     <code class="docutils literal notranslate">
      <span class="pre">
       inbranch
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       notinbranch
      </span>
     </code>
     Clauses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_SIMD.html#loop-carried-lexical-forward-dependence">
     Loop-Carried Lexical Forward Dependence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_linear_modifier.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       ref
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       val
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       uval
      </span>
     </code>
     Modifiers for
     <code class="docutils literal notranslate">
      <span class="pre">
       linear
      </span>
     </code>
     Clause
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_synchronization.html">
   Synchronization
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_critical.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       critical
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_worksharing_critical.html">
     Worksharing Constructs Inside a
     <code class="docutils literal notranslate">
      <span class="pre">
       critical
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_barrier_regions.html">
     Binding of
     <code class="docutils literal notranslate">
      <span class="pre">
       barrier
      </span>
     </code>
     Regions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_atomic.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       atomic
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_atomic_restrict.html">
     Restrictions on the
     <code class="docutils literal notranslate">
      <span class="pre">
       atomic
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_flush_nolist.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       flush
      </span>
     </code>
     Construct without a List
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_acquire_release.html">
     Synchronization Based on Acquire/Release Semantics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_ordered.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       ordered
      </span>
     </code>
     Clause and the
     <code class="docutils literal notranslate">
      <span class="pre">
       ordered
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_depobj.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       depobj
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_doacross.html">
     Doacross Loop Nest
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="Examples_locks.html">
     Lock Routines
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_init_lock.html">
       The
       <code class="docutils literal notranslate">
        <span class="pre">
         omp_init_lock
        </span>
       </code>
       Routine
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_init_lock_with_hint.html">
       The
       <code class="docutils literal notranslate">
        <span class="pre">
         omp_init_lock_with_hint
        </span>
       </code>
       Routine
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_lock_owner.html">
       Ownership of Locks
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_simple_lock.html">
       Simple Lock Routines
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_nestable_lock.html">
       Nestable Lock Routines
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_data_environment.html">
   Data Environment
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_threadprivate.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       threadprivate
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_default_none.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       default(none)
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_private.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       private
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_loopvar.html">
     Fortran Private Loop Iteration Variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_sp_common.html">
     Fortran Restrictions on
     <code class="docutils literal notranslate">
      <span class="pre">
       shared
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       private
      </span>
     </code>
     Clauses with Common Blocks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_sa_private.html">
     Fortran Restrictions on Storage Association with the
     <code class="docutils literal notranslate">
      <span class="pre">
       private
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_carrays_fpriv.html">
     C/C++ Arrays in a
     <code class="docutils literal notranslate">
      <span class="pre">
       firstprivate
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_lastprivate.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       lastprivate
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_reduction.html">
     Reduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_udr.html">
     User-Defined Reduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_scan.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       scan
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_copyin.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       copyin
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_copyprivate.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       copyprivate
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_cpp_reference.html">
     C++ Reference in Data-Sharing Clauses
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_memory_model.html">
   Memory Model
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_mem_model.html">
     The OpenMP Memory Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_allocators.html">
     Memory Allocators
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_race.html">
     Race Conditions Caused by Implied Copies of Shared Variables in Fortran
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_program_control.html">
   Program Control
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_cond_comp.html">
     Conditional Compilation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_icv.html">
     Internal Control Variables (ICVs)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_cancellation.html">
     Cancellation Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_requires.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       requires
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_variant.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
     </code>
     ~
     <code class="docutils literal notranslate">
      <span class="pre">
       variant
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_metadirective.html">
     Metadirective Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nested_loop.html">
     Nested Loop Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nesting_restrict.html">
     Restrictions on Nesting of Regions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_offload.html">
     Target Offload
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="History.html">
   Document Revision History
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/contents/Examples_affinity_display.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/passlab/Examples"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/passlab/Examples/issues/new?title=Issue%20on%20page%20%2Fcontents/Examples_affinity_display.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/passlab/Examples/main?urlpath=lab/tree/notebook/contents/Examples_affinity_display.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="affinity-display">
<h1>Affinity Display<a class="headerlink" href="#affinity-display" title="Permalink to this headline">¶</a></h1>
<p>The following examples illustrate ways to display thread affinity. Automatic display of affinity can be invoked by setting the  <code class="docutils literal notranslate"><span class="pre">OMP_DISPLAY_AFFINITY</span></code>  environment variable to  <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> .   The format of the output can be customized by setting the   <code class="docutils literal notranslate"><span class="pre">OMP_AFFINITY_FORMAT</span></code>  environment variable to an appropriate string.   Also, there are API calls for the user to display thread affinity  at selected locations within .</p>
<p>For the first example the environment variable  <code class="docutils literal notranslate"><span class="pre">OMP_DISPLAY_AFFINITY</span></code>  has been set to  <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> , and execution occurs on an 8-core system with  <code class="docutils literal notranslate"><span class="pre">OMP_NUM_THREADS</span></code>  set to 8.</p>
<p>The affinity for the master thread is reported through a call to the API  <code class="docutils literal notranslate"><span class="pre">omp_display_affinity()</span></code>  routine. For default affinity settings the report shows that the master thread can execute on any of the cores.  In the following parallel region the affinity for each of the team threads is reported automatically since the  <code class="docutils literal notranslate"><span class="pre">OMP_DISPLAY_AFFINITY</span></code>  environment variable has been set to  <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> .</p>
<p>These two reports are often useful (as in hybrid s using both MPI and OpenMP)  to observe the affinity (for an MPI task) before the parallel region, and during an OpenMP parallel region. Note: the next parallel region uses the  same number of threads as in the previous parallel region and affinities are  not changed, so affinity is NOT reported.</p>
<p>In the last parallel region, the thread affinities are reported because the thread affinity has changed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: affinity_display.1.c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_5.0</span>
<span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;omp.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>                     <span class="c1">//MAX threads = 8, single socket system</span>

   <span class="n">omp_display_affinity</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>  <span class="c1">//API call-- Displays Affinity of Master Thread</span>

<span class="c1">// API CALL OUTPUT (default format):</span>
<span class="c1">//team_num= 0, nesting_level= 0, thread_num= 0, thread_affinity= 0,1,2,3,4,5,6,7</span>


                   <span class="c1">// OMP_DISPLAY_AFFINITY=TRUE, OMP_NUM_THREADS=8</span>
   <span class="cp">#pragma omp parallel num_threads(omp_get_num_procs())</span>
   <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">omp_get_thread_num</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;1st Parallel Region -- Affinity Reported </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

         <span class="c1">// DISPLAY OUTPUT (default format) has been sorted:</span>
         <span class="c1">// team_num= 0, nesting_level= 1, thread_num= 0, thread_affinity= 0</span>
         <span class="c1">// team_num= 0, nesting_level= 1, thread_num= 1, thread_affinity= 1</span>
         <span class="c1">// ...</span>
         <span class="c1">// team_num= 0, nesting_level= 1, thread_num= 7, thread_affinity= 7</span>

     <span class="c1">// doing work here</span>
   <span class="p">}</span>

   <span class="cp">#pragma omp parallel num_threads( omp_get_num_procs() )</span>
   <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">omp_get_thread_num</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;Same Affinity as in Previous Parallel Region&quot;</span><span class="p">,</span>
                        <span class="s">&quot; -- no Affinity Reported</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

         <span class="c1">// NO AFFINITY OUTPUT:</span>
         <span class="c1">//(output in 1st parallel region only for OMP_DISPLAY_AFFINITY=TRUE)</span>

     <span class="c1">// doing more work here</span>
   <span class="p">}</span>

                       <span class="c1">// Report Affinity for 1/2 number of threads</span>
   <span class="cp">#pragma omp parallel num_threads( omp_get_num_procs()/2 )</span>
   <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">omp_get_thread_num</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Report Affinity for using 1/2 of max threads.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

         <span class="c1">// DISPLAY OUTPUT (default format) has been sorted:</span>
         <span class="c1">// team_num= 0, nesting_level= 1, thread_num= 0, thread_affinity= 0,1</span>
         <span class="c1">// team_num= 0, nesting_level= 1, thread_num= 1, thread_affinity= 2,3</span>
         <span class="c1">// team_num= 0, nesting_level= 1, thread_num= 2, thread_affinity= 4,5</span>
         <span class="c1">// team_num= 0, nesting_level= 1, thread_num= 3, thread_affinity= 6,7</span>

     <span class="c1">// do work</span>
   <span class="p">}</span>

   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">affinity_display</span><span class="mf">.1</span><span class="p">.</span><span class="n">f90</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">free</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span> <span class="n">omp_5</span><span class="mf">.0</span>

<span class="n">program</span> <span class="n">affinity_display</span>        <span class="o">!</span> <span class="n">MAX</span> <span class="n">threads</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">single</span> <span class="n">socket</span> <span class="n">system</span>

   <span class="n">use</span> <span class="n">omp_lib</span>
   <span class="n">implicit</span> <span class="n">none</span>
   <span class="n">character</span><span class="p">(</span><span class="n">len</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">::</span> <span class="n">null</span>

   <span class="n">call</span> <span class="n">omp_display_affinity</span><span class="p">(</span><span class="n">null</span><span class="p">)</span> <span class="o">!</span><span class="n">API</span> <span class="n">call</span><span class="o">-</span> <span class="n">Displays</span> <span class="n">Affinity</span> <span class="n">of</span> <span class="n">Master</span> <span class="n">Thread</span>

<span class="o">!</span> <span class="n">API</span> <span class="n">CALL</span> <span class="n">OUTPUT</span> <span class="p">(</span><span class="k">default</span> <span class="n">format</span><span class="p">)</span><span class="o">:</span>
<span class="o">!</span> <span class="n">team_num</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nesting_level</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">thread_num</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">thread_affinity</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span>


                       <span class="o">!</span> <span class="n">OMP_DISPLAY_AFFINITY</span><span class="o">=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">OMP_NUM_THREADS</span><span class="o">=</span><span class="mi">8</span>

   <span class="o">!</span><span class="n">$omp</span> <span class="n">parallel</span> <span class="n">num_threads</span><span class="p">(</span><span class="n">omp_get_num_procs</span><span class="p">())</span>

     <span class="k">if</span><span class="p">(</span><span class="n">omp_get_thread_num</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="n">then</span>
        <span class="n">print</span><span class="o">*</span><span class="p">,</span> <span class="s">&quot;1st Parallel Region  -- Affinity Reported&quot;</span>
     <span class="n">endif</span>

          <span class="o">!</span> <span class="n">DISPLAY</span> <span class="n">OUTPUT</span> <span class="p">(</span><span class="k">default</span> <span class="n">format</span><span class="p">)</span> <span class="n">has</span> <span class="n">been</span> <span class="nl">sorted</span><span class="p">:</span>
          <span class="o">!</span> <span class="n">team_num</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nesting_level</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">thread_num</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">thread_affinity</span><span class="o">=</span> <span class="mi">0</span>
          <span class="o">!</span> <span class="n">team_num</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nesting_level</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">thread_num</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">thread_affinity</span><span class="o">=</span> <span class="mi">1</span>
          <span class="o">!</span> <span class="p">...</span>
          <span class="o">!</span> <span class="n">team_num</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nesting_level</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">thread_num</span><span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">thread_affinity</span><span class="o">=</span> <span class="mi">7</span>

      <span class="o">!</span> <span class="n">doing</span> <span class="n">work</span> <span class="n">here</span>

   <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">parallel</span>

   <span class="o">!</span><span class="n">$omp</span> <span class="n">parallel</span> <span class="n">num_threads</span><span class="p">(</span> <span class="n">omp_get_num_procs</span><span class="p">()</span> <span class="p">)</span>

     <span class="k">if</span><span class="p">(</span><span class="n">omp_get_thread_num</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="n">then</span>
        <span class="n">print</span><span class="o">*</span><span class="p">,</span> <span class="s">&quot;Same Affinity in Parallel Region -- no Affinity Reported&quot;</span>
     <span class="n">endif</span>

          <span class="o">!</span> <span class="n">NO</span> <span class="n">AFFINITY</span> <span class="nl">OUTPUT</span><span class="p">:</span>
          <span class="o">!</span><span class="p">(</span><span class="n">output</span> <span class="n">in</span> <span class="mi">1</span><span class="n">st</span> <span class="n">parallel</span> <span class="n">region</span> <span class="n">only</span> <span class="k">for</span> <span class="n">OMP_DISPLAY_AFFINITY</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>

      <span class="o">!</span> <span class="n">doing</span> <span class="n">more</span> <span class="n">work</span> <span class="n">here</span>

   <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">parallel</span>

                       <span class="o">!</span> <span class="n">Report</span> <span class="n">Affinity</span> <span class="k">for</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="n">number</span> <span class="n">of</span> <span class="n">threads</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">parallel</span> <span class="n">num_threads</span><span class="p">(</span> <span class="n">omp_get_num_procs</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span>

     <span class="k">if</span><span class="p">(</span><span class="n">omp_get_thread_num</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="n">then</span>
        <span class="n">print</span><span class="o">*</span><span class="p">,</span> <span class="s">&quot;Different Affinity in Parallel Region -- Affinity Reported&quot;</span>
     <span class="n">endif</span>

         <span class="o">!</span> <span class="n">DISPLAY</span> <span class="n">OUTPUT</span> <span class="p">(</span><span class="k">default</span> <span class="n">format</span><span class="p">)</span> <span class="n">has</span> <span class="n">been</span> <span class="nl">sorted</span><span class="p">:</span>
         <span class="o">!</span> <span class="n">team_num</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nesting_level</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">thread_num</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">thread_affinity</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span>
         <span class="o">!</span> <span class="n">team_num</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nesting_level</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">thread_num</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">thread_affinity</span><span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="mi">3</span>
         <span class="o">!</span> <span class="n">team_num</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nesting_level</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">thread_num</span><span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">thread_affinity</span><span class="o">=</span> <span class="mi">4</span><span class="p">,</span><span class="mi">5</span>
         <span class="o">!</span> <span class="n">team_num</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nesting_level</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">thread_num</span><span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">thread_affinity</span><span class="o">=</span> <span class="mi">6</span><span class="p">,</span><span class="mi">7</span>

      <span class="o">!</span> <span class="k">do</span> <span class="n">work</span>

   <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">parallel</span>

<span class="n">end</span> <span class="n">program</span>

</pre></div>
</div>
</div>
</div>
<p>In the following example 2 threads are forked, and each executes on a socket. Next, a nested parallel region runs half of the available threads on each socket.</p>
<p>These OpenMP environment variables have been set:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">OMP_PROC_BIND</span></code> =’TRUE’</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OMP_NUM_THREADS</span></code> =’2,4’</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OMP_PLACES</span></code> =’{0,2,4,6},{1,3,5,7}’</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OMP_AFFINITY_FORMAT</span></code> =’nest_level=
L, parent_thrd_num=
a, thrd_num=
n, thrd_affinity=
A’</p></li>
</ul>
<p>where the numbers correspond to core ids for the system. Note,  <code class="docutils literal notranslate"><span class="pre">OMP_DISPLAY_AFFINITY</span></code>  is not set and is  <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>  by default.  This example shows how to use API routines to perform affinity display operations.</p>
<p>For each of the two first-level threads the  <code class="docutils literal notranslate"><span class="pre">OMP_PLACES</span></code>  variable specifies a place with all the core-ids of the socket ({0,2,4,6} for one thread and {1,3,5,7} for the other). (As is sometimes the case in 2-socket systems, one socket may consist of the even id numbers, while the other may have the odd id numbers.)  The affinities are printed according to the  <code class="docutils literal notranslate"><span class="pre">OMP_AFFINITY_FORMAT</span></code>  format: providing the parallel nesting level (
L), the ancestor thread number (
a), the thread number (
n) and the thread affinity (
A). In the nested parallel region within the  <em>socket_work</em>  routine the affinities for the threads on each socket are printed according to this format.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name:       affinity_display.2c</span>
<span class="cm">* type:       C</span>
<span class="cm">* version: omp_5.0</span>
<span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;omp.h&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">socket_work</span><span class="p">(</span><span class="kt">int</span> <span class="n">socket_num</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n_thrds</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
 <span class="kt">int</span> <span class="n">n_sockets</span><span class="p">,</span> <span class="n">socket_num</span><span class="p">,</span> <span class="n">n_thrds_on_socket</span><span class="p">;</span>

 <span class="n">omp_set_nested</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>            <span class="c1">// or env var= OMP_NESTED=true</span>
 <span class="n">omp_set_max_active_levels</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// or env var= OMP_MAX_ACTIVE_LEVELS=2</span>

  <span class="n">n_sockets</span>         <span class="o">=</span> <span class="n">omp_get_num_places</span><span class="p">();</span>
  <span class="n">n_thrds_on_socket</span> <span class="o">=</span> <span class="n">omp_get_place_num_procs</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

     <span class="c1">// OMP_NUM_THREADS=2,4</span>
     <span class="c1">// OMP_PLACES=&quot;{0,2,4,6},{1,3,5,7}&quot;  #2 sockets; even/odd proc-ids</span>
     <span class="c1">// OMP_AFFINITY_FORMAT=\</span>
<span class="c1">     // &quot;nest_level= %L, parent_thrd_num= %a, thrd_num= %n, thrd_affinity= %A&quot;</span>

  <span class="cp">#pragma omp parallel num_threads(n_sockets) private(socket_num)</span>
  <span class="p">{</span>
    <span class="n">socket_num</span> <span class="o">=</span> <span class="n">omp_get_place_num</span><span class="p">();</span>

    <span class="k">if</span><span class="p">(</span><span class="n">socket_num</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
       <span class="n">printf</span><span class="p">(</span><span class="s">&quot; LEVEL 1 AFFINITIES 1 thread/socket, %d sockets:</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">n_sockets</span><span class="p">);</span>

    <span class="n">omp_display_affinity</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>   <span class="c1">// not needed if OMP_DISPLAY_AFFINITY=TRUE</span>

     <span class="c1">// OUTPUT:</span>
     <span class="c1">// LEVEL 1 AFFINITIES 1 thread/socket, 2 sockets:</span>
     <span class="c1">// nest_level= 1, parent_thrd_num= 0, thrd_num= 0, thrd_affinity= 0,2,4,6</span>
     <span class="c1">// nest_level= 1, parent_thrd_num= 0, thrd_num= 1, thrd_affinity= 1,3,5,7</span>

    <span class="n">socket_work</span><span class="p">(</span><span class="n">socket_num</span><span class="p">,</span> <span class="n">n_thrds_on_socket</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">socket_work</span><span class="p">(</span><span class="kt">int</span> <span class="n">socket_num</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n_thrds</span><span class="p">)</span>
<span class="p">{</span>
  <span class="cp">#pragma omp parallel num_threads(n_thrds)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">omp_get_thread_num</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot; LEVEL 2 AFFINITIES, %d threads on socket %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">n_thrds</span><span class="p">,</span> <span class="n">socket_num</span><span class="p">);</span>

    <span class="n">omp_display_affinity</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>   <span class="c1">// not needed if OMP_DISPLAY_AFFINITY=TRUE</span>

    <span class="c1">// OUTPUT:</span>
    <span class="c1">// LEVEL 2 AFFINITIES, 4 threads on socket 0</span>
    <span class="c1">// nest_level= 2, parent_thrd_num= 0, thrd_num= 0, thrd_affinity= 0</span>
    <span class="c1">// nest_level= 2, parent_thrd_num= 0, thrd_num= 1, thrd_affinity= 2</span>
    <span class="c1">// nest_level= 2, parent_thrd_num= 0, thrd_num= 2, thrd_affinity= 4</span>
    <span class="c1">// nest_level= 2, parent_thrd_num= 0, thrd_num= 3, thrd_affinity= 6</span>

    <span class="c1">// LEVEL 2 AFFINITIES, 4 threads on socket 1</span>
    <span class="c1">// nest_level= 2, parent_thrd_num= 1, thrd_num= 0, thrd_affinity= 1</span>
    <span class="c1">// nest_level= 2, parent_thrd_num= 1, thrd_num= 1, thrd_affinity= 3</span>
    <span class="c1">// nest_level= 2, parent_thrd_num= 1, thrd_num= 2, thrd_affinity= 5</span>
    <span class="c1">// nest_level= 2, parent_thrd_num= 1, thrd_num= 3, thrd_affinity= 7</span>

    <span class="c1">// ... Do Some work on Socket</span>

  <span class="p">}</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
! name: affinity_display.2.f90
! type: F-free
! version: omp_5.0

program affinity_display

   use omp_lib
   implicit none
   character(len=0) :: null
   integer          :: n_sockets, socket_num, n_thrds_on_socket;

   call omp_set_nested(.true.)        ! or env var= OMP_NESTED=true
   call omp_set_max_active_levels(2)  ! or env var= OMP_MAX_ACTIVE_LEVELS=2

   n_sockets         = omp_get_num_places()
   n_thrds_on_socket = omp_get_place_num_procs(0)

    ! OMP_NUM_THREADS=2,4
    ! OMP_PLACES=&quot;{0,2,4,6},{1,3,5,7}&quot;  #2 sockets; even/odd proc-ids
    ! OMP_AFFINITY_FORMAT=\
    !     &quot;nest_level= %L, parent_thrd_num= %a, thrd_num= %n, thrd_affinity= %A&quot;

   !$omp parallel num_threads(n_sockets) private(socket_num)

     socket_num = omp_get_place_num()

     if(socket_num==0) then
       write(*,&#39;(&quot;LEVEL 1 AFFINITIES 1 thread/socket &quot;,i0,&quot; sockets&quot;)&#39;)n_sockets
     endif

     call omp_display_affinity(null)  !not needed if OMP_DISPLAY_AFFINITY=TRUE

       ! OUTPUT:
       ! LEVEL 1 AFFINITIES 1 thread/socket, 2 sockets:
       ! nest_level= 1, parent_thrd_num= 0, thrd_num= 0, thrd_affinity= 0,2,4,6
       ! nest_level= 1, parent_thrd_num= 0, thrd_num= 1, thrd_affinity= 1,3,5,7

     call socket_work(socket_num, n_thrds_on_socket)

   !$omp end parallel

end program

subroutine socket_work(socket_num, n_thrds)
   use omp_lib
   implicit none
   integer :: socket_num, n_thrds
   character(len=0) :: null

   !$omp parallel num_threads(n_thrds)

      if(omp_get_thread_num()==0) then
      write(*,&#39;(&quot;LEVEL 2 AFFINITIES, &quot;,i0,&quot; threads on socket &quot;,i0)&#39;) &amp;
            n_thrds,socket_num
      endif

      call omp_display_affinity(null);  !not needed if OMP_DISPLAY_AFFINITY=TRUE

      ! OUTPUT:
      ! LEVEL 2 AFFINITIES, 4 threads on socket 0
      ! nest_level= 2, parent_thrd_num= 0, thrd_num= 0, thrd_affinity= 0
      ! nest_level= 2, parent_thrd_num= 0, thrd_num= 1, thrd_affinity= 2
      ! nest_level= 2, parent_thrd_num= 0, thrd_num= 2, thrd_affinity= 4
      ! nest_level= 2, parent_thrd_num= 0, thrd_num= 3, thrd_affinity= 6

      ! LEVEL 2 AFFINITIES, 4 thrds on socket 1
      ! nest_level= 2, parent_thrd_num= 1, thrd_num= 0, thrd_affinity= 1
      ! nest_level= 2, parent_thrd_num= 1, thrd_num= 1, thrd_affinity= 3
      ! nest_level= 2, parent_thrd_num= 1, thrd_num= 2, thrd_affinity= 5
      ! nest_level= 2, parent_thrd_num= 1, thrd_num= 3, thrd_affinity= 7

      ! ... Do Some work on Socket

   !$omp end parallel

end subroutine

</pre></div>
</div>
</div>
</div>
<p>The next example illustrates more details about affinity formatting. First, the  <code class="docutils literal notranslate"><span class="pre">omp_get_affininity_format()</span></code>  API routine is used to  obtain the default format. The  checks to make sure the storage  provides enough space to hold the format.   Next, the  <code class="docutils literal notranslate"><span class="pre">omp_set_affinity_format()</span></code>  API routine sets a user-defined  format:  <em>host=
20H thrd_num=
0.4n binds_to=
A</em> .</p>
<p>The host, thread number and affinity fields are specified by  _
20H_ ,   _
0.4n_  and  _
A_ :  <em>H</em> ,  <em>n</em>  and  <em>A</em>  are single character ‘short names’  for the host, thread_num and thread_affinity data to be printed, with format sizes of  <em>20</em> ,  <em>4</em> , and ‘size as needed’.  The period (.) indicates that the field is displayed right-justified (default is left-justified)  and the ‘0’ indicates that any unused space is to be prefixed with zeros  (e.g. instead of ‘1’, ‘0001’ is displayed for the field size of 4).</p>
<p>The period (.) indicates that the field is displayed left-justified and the ‘0’ indicates<br />
that leading zeros are to be added so that the total length for the display of this “n” (thread_num) field is 4.</p>
<p>The period ( <em>.</em> ) indicates right justified and  <em>0</em>  leading zeros.<br />
All other text in the format is just user narrative.</p>
<p>Within the parallel region the affinity for each thread is captured by   <code class="docutils literal notranslate"><span class="pre">omp_capture_affinity()</span></code>  into a buffer array with elements indexed  by the thread number ( <em>thrd_num</em> ). After the parallel region, the thread affinities are printed in thread-number order.</p>
<p>If the storage area in buffer is inadequate for holding the affinity data, the stored affinity data is truncated.<br />
The  <em>max</em>  reduction on the required storage, returned by<br />
<code class="docutils literal notranslate"><span class="pre">omp_capture_affinity</span></code>  in  <em>nchars</em> , is used to report<br />
possible truncation (if  <em>max_req_store</em>   &gt;   <em>buffer_store</em> ). The maximum value for the number of characters ( <em>nchars</em> ) returned by   <code class="docutils literal notranslate"><span class="pre">omp_capture_affinity</span></code>  is captured by the  <code class="docutils literal notranslate"><span class="pre">reduction(max:max_req_store)</span></code>  clause and the  <em>if(nchars &gt;= max_req_store) max_req_store=nchars</em>  statement.  It is used to report possible truncation (if  <em>max_req_store</em>  &gt;  <em>buffer_store</em> ).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: affinity_display.3.c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_5.0</span>
<span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="c1">  // also null is in &lt;stddef.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stddef.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;omp.h&gt;</span><span class="cp"></span>

<span class="cp">#define FORMAT_STORE   80</span>
<span class="cp">#define BUFFER_STORE   80</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>

   <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">thrd_num</span><span class="p">,</span> <span class="n">max_req_store</span><span class="p">;</span>
   <span class="kt">size_t</span> <span class="n">nchars</span><span class="p">;</span>

   <span class="kt">char</span> <span class="n">default_format</span><span class="p">[</span><span class="n">FORMAT_STORE</span><span class="p">];</span>
   <span class="kt">char</span> <span class="n">my_format</span><span class="p">[]</span>  <span class="o">=</span> <span class="s">&quot;host=%20H thrd_num=%0.4n binds_to=%A&quot;</span><span class="p">;</span>
   <span class="kt">char</span> <span class="o">**</span><span class="n">buffer</span><span class="p">;</span>


<span class="c1">// CODE SEGMENT 1         AFFINITY FORMAT</span>

<span class="c1">//                        Get and Display Default Affinity Format</span>

   <span class="n">nchars</span> <span class="o">=</span> <span class="n">omp_get_affinity_format</span><span class="p">(</span><span class="n">default_format</span><span class="p">,(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">FORMAT_STORE</span><span class="p">);</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Default Affinity Format is: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">default_format</span><span class="p">);</span>

   <span class="k">if</span><span class="p">(</span><span class="n">nchars</span> <span class="o">&gt;=</span> <span class="n">FORMAT_STORE</span><span class="p">){</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Caution: Reported Format is truncated.  Increase</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;         FORMAT_STORE to %d.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">nchars</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
   <span class="p">}</span>

<span class="c1">//                        Set Affinity Format</span>

   <span class="n">omp_set_affinity_format</span><span class="p">(</span><span class="n">my_format</span><span class="p">);</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Affinity Format set to: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">my_format</span><span class="p">);</span>


<span class="c1">// CODE SEGMENT 2         CAPTURE AFFINITY</span>

<span class="c1">//                        Set up buffer for affinity of n threads</span>

   <span class="n">n</span> <span class="o">=</span> <span class="n">omp_get_num_procs</span><span class="p">();</span>
   <span class="n">buffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="p">);</span>
   <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span> <span class="o">*</span> <span class="n">BUFFER_STORE</span><span class="p">);</span> <span class="p">}</span>

<span class="c1">//                        Capture Affinity using Affinity Format set above.</span>
<span class="c1">//                        Use max reduction to check size of buffer areas</span>
   <span class="n">max_req_store</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="cp">#pragma omp parallel private(thrd_num,nchars) reduction(max:max_req_store)</span>
   <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">omp_get_num_threads</span><span class="p">()</span><span class="o">&gt;</span><span class="n">n</span><span class="p">)</span> <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">//safety: don&#39;t exceed # of buffers</span>

      <span class="n">thrd_num</span><span class="o">=</span><span class="n">omp_get_thread_num</span><span class="p">();</span>
      <span class="n">nchars</span><span class="o">=</span><span class="n">omp_capture_affinity</span><span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="n">thrd_num</span><span class="p">],(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">BUFFER_STORE</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">nchars</span> <span class="o">&gt;</span> <span class="n">max_req_store</span><span class="p">)</span> <span class="n">max_req_store</span><span class="o">=</span><span class="n">nchars</span><span class="p">;</span>

      <span class="c1">// ...</span>
   <span class="p">}</span>

   <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;thrd_num= %d, affinity: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span><span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
   <span class="p">}</span>
         <span class="c1">// For 4 threads with OMP_PLACES=&#39;{0,1},{2,3},{4,5},{6,7}&#39;</span>
         <span class="c1">// Format    host=%20H thrd_num=%0.4n binds_to=%A</span>

         <span class="c1">// affinity: host=hpc.cn567            thrd_num=0000 binds_to=0,1</span>
         <span class="c1">// affinity: host=hpc.cn567            thrd_num=0001 binds_to=2,3</span>
         <span class="c1">// affinity: host=hpc.cn567            thrd_num=0002 binds_to=4,5</span>
         <span class="c1">// affinity: host=hpc.cn567            thrd_num=0003 binds_to=6,7</span>


   <span class="k">if</span><span class="p">(</span><span class="n">max_req_store</span><span class="o">&gt;=</span><span class="n">BUFFER_STORE</span><span class="p">){</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Caution: Affinity string truncated.  Increase</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;         BUFFER_STORE to %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">max_req_store</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">free</span><span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
   <span class="n">free</span> <span class="p">(</span><span class="n">buffer</span><span class="p">);</span>

   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
! name: affinity_display.3.f90
! type: F-free
! version: omp_5.0

program affinity_display
   use omp_lib
   implicit none
   integer, parameter :: FORMAT_STORE=80
   integer, parameter :: BUFFER_STORE=80

   integer            :: i, n, thrd_num, nchars, max_req_store

   character(FORMAT_STORE)     :: default_format
   character(*), parameter     :: my_format = &amp;
                                  &quot;host=%20H thrd_num=%0.4n binds_to=%A&quot;
   character(:), allocatable   :: buffer(:)
   character(len=0)            :: null


!  CODE SEGMENT 1         AFFINITY FORMAT

!                         Get and Display Default Affinity Format

   nchars = omp_get_affinity_format(default_format)
   print*,&quot;Default Affinity Format: &quot;, trim(default_format)

   if( nchars &gt; FORMAT_STORE) then
      print*,&quot;Caution: Reported Format is truncated.  Increase&quot;
      print*,&quot;         FORMAT_STORE to &quot;, nchars
   endif

!                         Set Affinity Format

   call omp_set_affinity_format(my_format)
   print*,&quot;Affinity Format set to: &quot;, my_format


!  CODE SEGMENT 2         CAPTURE AFFINITY

!                         Set up buffer for affinity of n threads

   n = omp_get_num_procs()
   allocate( character(len=BUFFER_STORE)::buffer(0:n-1) )

!                         Capture Affinity using Affinity Format set above.
!                         Use max reduction to check size of buffer areas
   max_req_store = 0
   !$omp parallel private(thrd_num,nchars) reduction(max:max_req_store)

      if(omp_get_num_threads()&gt;n) stop &quot;ERROR: increase buffer lines&quot;

      thrd_num=omp_get_thread_num()
      nchars=omp_capture_affinity(buffer(thrd_num),null)
      if(nchars&gt;max_req_store) max_req_store=nchars
      !  ...

   !$omp end parallel

   do i = 0, n-1
      print*, &quot;thrd_num= &quot;,i,&quot;   affinity:&quot;, trim(buffer(i))
   end do
         !  For 4 threads with OMP_PLACES=&#39;{0,1},{2,3},{4,5},{6,7}&#39;
         !  Format:   host=%20H thrd_num=%0.4n binds_to=%A

         !  affinity: host=hpc.cn567            thrd_num=0000 binds_to=0,1
         !  affinity: host=hpc.cn567            thrd_num=0001 binds_to=2,3
         !  affinity: host=hpc.cn567            thrd_num=0002 binds_to=4,5
         !  affinity: host=hpc.cn567            thrd_num=0003 binds_to=6,7

   if(max_req_store &gt; BUFFER_STORE) then
      print*,  &quot;Caution: Affinity string truncated.  Increase&quot;
      print*,  &quot;         BUFFER_STORE to &quot;,max_req_store
   endif

   deallocate(buffer)
end program

</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "native"
        },
        kernelOptions: {
            kernelName: "native",
            path: "./contents"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'native'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="Examples_task_affinity.html" title="previous page">Task Affinity</a>
    <a class='right-next' id="next-link" href="Examples_affinity_query.html" title="next page">Affinity Query Functions</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The OpenMP Community<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>